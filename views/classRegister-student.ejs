<!DOCTYPE html>
<html lang="ua">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="..\style\style.css"><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <title>DepartmentService</title>
</head>
<body>
    <div class="wrapper">
        <%- include('view-blocks/header') %>
        <main>
            <section class="classRegister-student container-fluid">
                <table class="cadets-table table table-striped">
                    <% var arr = []; %>
                    <% var marks = [] %>
                    <% for(var i = 0; i < params.length;i++) { %>
                        <% if(!arr.includes(params[i].lastname)){ %>
                            <%
                                arr.push(params[i].lastname) %>
                            <% marks.push({
                                name: params[i].firstname,
                                lastName: params[i].lastname,
                                marks: [{mark: params[i].mark, numberOfL: params[i].numberOfL, type: params[i].type}]
                            }) %>
                            <%      %>
                        <% }else{ %>
                            <% marks.forEach((m) => {
                                if (m.lastName === params[i].lastname) {
                                    m.marks.push({
                                        mark: params[i].mark,
                                        numberOfL: params[i].numberOfL,
                                        type: params[i].type
                                    })
                                }
                            }) %>
                        <% } %>
                    <% } %>
    
                    <% for(var i = 0; i < marks.length;i++){ %>
                    <% marks[i].marks.sort(function (a, b) { %>
                        <% var result; %>
                        <% a = a.numberOfL.split('.'); %>
                        <% b = b.numberOfL.split('.'); %>
    
                        <% while (a.length) { %>
                        <% result = a.shift() - (b.shift() || 0); %>
                        <% if (result) { %>
                        <% return result; %>
                        <% } %>
                        <% } %>
    
                        <% return -b.length; %>
                    <% }).join(','); %>
                    <% } %>
    
                    <tr>
                        <th class="thclass">
    
                            <div id="triangle-bottomleft">
                                <p class="lesontable2"> Заняття</p>
    
                                <p class="lesontable"> Прізвище</p>
    
                            </div>
                        </th>
                        <th>Сума</th>
                        <% for(var i = 0; i < marks[0].marks.length;i++) { %>
                            <th><%= marks[0].marks[i].numberOfL %></th>
                        <% } %>
                    </tr>
    
                    <% for(var i = 0; i < arr.length;i++) { %>
                        <tr>
                            <% var count = 0 %>
                            <% for(var j = 0; j < marks[i].marks.length;j++){ %>
                                <% count += marks[i].marks[j].mark %>
                            <% } %>
                            <td><%= marks[i].lastName %> <%= marks[i].name[0] %>.</td>
                            <td><%= count.toFixed(2) %></td>
                            <% for(var j = 0; j < marks[i].marks.length;j++){ %>
                                <td><%= marks[i].marks[j].mark %></td>
                            <% } %>
                        </tr>
                    <% } %>
    
                </table>
            </section>
        </main>
        <%- include('view-blocks/footer') %>
    </div>
</body>

<script>
    document.getElementById("header_title").innerHTML = "";
  document.querySelectorAll('.teach').forEach(x=>x.style.display="none");
</script>
</html>